<!DOCTYPE html>
<html lang='en'>
<head>
    <meta charset='utf-8' />
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = '730180124578-n6kv46c1eoi5159t1jhb6jbu5db914o3.apps.googleusercontent.com';
        const API_KEY = 'AIzaSyCCCLytqT96rJQsmKF5i74uswlwQHm76oc';
        const DISCOVERY_DOCS = ["https://www.googleapis.com/discovery/v1/apis/calendar/v3/rest"];
        const SCOPES = "https://www.googleapis.com/auth/calendar.events.readonly";

        let calendar;
        
        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: DISCOVERY_DOCS,
                scope: SCOPES
            }).then(() => {
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());
            }).catch(error => {
                console.error("Error initializing Google API client", error);
            });
        }

        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignoutClick() {
            gapi.auth2.getAuthInstance().signOut();
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                loadCalendarEvents();
            } else {
                console.log("User not signed in");
            }
        }

        function loadCalendarEvents() {
            gapi.client.calendar.events.list({
                calendarId: 'primary',
                timeMin: new Date().toISOString(),
                showDeleted: false,
                singleEvents: true,
                maxResults: 10,
                orderBy: 'startTime'
            }).then(response => {
                const events = response.result.items;
                if (events.length) {
                    let eventList = events.map(event => ({
                        title: event.summary,
                        start: event.start.dateTime || event.start.date
                    }));
                    renderCalendar(eventList);
                } else {
                    console.log("No upcoming events found.");
                }
            });
        }

        function renderCalendar(events) {
            var calendarEl = document.getElementById('calendar');
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: events,
                selectable: true
            });
            calendar.render();
        }

        function goToGoogleCalendar() {
            window.location.href = 'https://calendar.google.com/';
        }

        gapi.load('client:auth2', initClient);
    </script>
</head>
<body>
    <button onclick="handleAuthClick()">Sign in with Google</button>
    <button onclick="handleSignoutClick()">Sign out</button>
    <div id='calendar'></div>
    <button class="calendar-btn" onclick="goToGoogleCalendar()">Google Calendar</button>
</body>
<style>
    .calendar-btn {
        background-color: green;
        color: white;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
        margin-top: 10px;
        border-radius: 15px;
    }

    .calendar-btn:hover {
        background-color: darkgreen;
    }
</style>
</html>
